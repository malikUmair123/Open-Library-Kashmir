
@model Open_Library_Kashmir.Models.WishlistViewModel
<head>
    <style>
        /* Always show these columns */
        .title-col, .author-col {
            display: table-cell;
        }

        /* Hide on smaller screens (Example breakpoint) */
        @@media (max-width: 768px) {
            .publisher-col, .class-col, .avail-at-col {
                display: none;
            }
        }
    </style>
</head>
<h2>My Wishlist</h2>

@if (Model.Books?.Any() ?? false)
{
    <table>
        <thead>
            <tr>
                <th class="title-col">
                    @Html.DisplayNameFor(model => model.Books.FirstOrDefault().Title)
                </th>
                <th class="author-col">
                    @Html.DisplayNameFor(model => model.Books.FirstOrDefault().Author)
                </th>
                <th class="class-col">
                    @Html.DisplayNameFor(model => model.Books.FirstOrDefault().Class)
                </th>
                <th class="publisher-col">
                    @Html.DisplayNameFor(model => model.Books.FirstOrDefault().Publisher)
                </th>
                <th class="avail-at-col">
                    @Html.DisplayNameFor(model => model.Books.FirstOrDefault().AvailableAt)
                </th>
            </tr>

        </thead>
        <tbody>
            @foreach (var item in Model.Books)
            {
                <tr>

                    <td class="title-col">
                        @Html.ActionLink(item.Title, "BookDetails", new { id = item.BookId })
                    </td>
                    <td class="author-col">
                        @Html.DisplayFor(modelItem => item.Author)
                    </td>
                    <td class="class-col">
                        @Html.DisplayFor(modelItem => item.@Class)
                    </td>
                    <td class="publisher-col">
                        @Html.DisplayFor(modelItem => item.Publisher)
                    </td>
                    <td class="avail-at-col">
                        @Html.DisplayFor(modelItem => item.AvailableAt)
                    </td>
                </tr>
            }
        </tbody>
    </table>

    if (Request.IsAuthenticated)
    {
        <h4>You need to fill in additional details to reqeust books:</h4>

        @*using (Html.BeginForm("CreateRecipient", "Donation", FormMethod.Post))
            {
                <button type="submit" class="btn btn-primary">Fill Additional Details</button>
            }*@
        @Html.ActionLink("Fill Additional Details »", "EditRecipient", "Donation", routeValues: null@*new {model = Model}*@, htmlAttributes: new { id = "mamagelink", title = "Manage", @class = "btn btn-primary btn-md" })

    }
    else
    {
        <p>Register your details to request these books: </p>
        @Html.ActionLink("Register", "Register", "Account", routeValues: null, htmlAttributes: new { id = "registerLink", title = "Update", @class = "btn btn-outline-dark" })
    }
}

else
{
    <h4>Your wishlist is empty.</h4>
}

@*//model javascript and jquery on this*@
@*<script>
        $(document).ready(function () {
            // Function to update wishlist count badge
            function updateWishlistCount() {
                $.ajax({
                    url: '/Donation/GetWishlistCount',
                    type: 'GET',
                    success: function (data) {
                        var count = data.Count;
                        $('#wishlist-count-badge').text(count);
                        // Show badge
                        $('#wishlist-count-badge').show();
                    },
                    error: function () {
                        console.log('Error fetching wishlist count.');
                    }
                });
            }

            // Call updateWishlistCount initially
            updateWishlistCount();

            // Event handler for adding book to wishlist
            $('#add-to-wishlist-btn').click(function (e) {
                e.preventDefault(); // Prevent default form submission behavior
                var form = $(this).closest('form');
                $.ajax({
                    url: form.attr('action'),
                    type: 'POST',
                    data: form.serialize(),
                    success: function () {
                        updateWishlistCount(); // Update wishlist count after adding book
                        $('#add-to-wishlist-btn').prop('disabled', true);

                        // Change the button text to "Added to Wishlist"
                        $('#add-to-wishlist-btn').text('Added to Wishlist');

                        // Change the button color to represent it has been added to wishlist
                        $('#add-to-wishlist-btn').removeClass('btn-primary').addClass('btn-success');
                    },
                    error: function () {
                        console.log('Error adding book to wishlist.');
                    }
                });
            });
        });

    </script>*@
